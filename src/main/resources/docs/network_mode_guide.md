# HL7客户端网络模式使用指南

本文档提供关于HL7客户端应用程序支持的网络连接模式的详细说明。应用程序现在支持两种网络模式：客户端模式和服务器模式。

## 模式对比

| 特性 | 客户端模式 (CLIENT) | 服务器模式 (SERVER) |
|-----|-------------------|-------------------|
| 连接建立 | 主动连接到远程服务器 | 监听端口，等待客户端连接 |
| 适用场景 | 连接到已存在的服务器 | 作为服务端接收连接 |
| 连接参数格式 | `host:port:protocol:CLIENT[:longConnection]` | `port:protocol:SERVER` |
| 连接状态判断 | 是否成功连接到服务器 | 是否有客户端连接 |

## 配置说明

### 客户端模式 (CLIENT)

作为客户端主动连接到远程服务器，需要配置以下参数：

- **主机地址**：远程服务器的IP地址或主机名 (例如：`192.168.1.100` 或 `localhost`)
- **端口**：远程服务器监听的端口号 (例如：`8088`)
- **协议**：通信协议，支持 `TCP` 或 `UDP`，建议使用 `TCP`
- **连接模式**：在界面上选择 `CLIENT`，表示客户端模式
- **保持长连接**：是否保持长连接

连接参数格式示例：`192.168.1.100:8088:TCP:CLIENT:true`

### 服务器模式 (SERVER)

作为服务器监听端口等待客户端连接，需要配置以下参数：

- **端口**：本地监听的端口号 (例如：`8088`)
- **协议**：通信协议，支持 `TCP` 或 `UDP`，建议使用 `TCP`
- **连接模式**：在界面上选择 `SERVER`，表示服务器模式

连接参数格式示例：`8088:TCP:SERVER`

## 使用方法

### 添加设备

1. 点击"添加设备"按钮
2. 填写设备基本信息（名称、型号、厂商）
3. 连接类型选择 `NETWORK`
4. 在网络连接参数面板中：
   - 选择连接模式（客户端/服务器）
   - 选择通信协议
   - 根据模式填写相应参数
5. 点击"确定"保存设备

### 连接设备

- **客户端模式**：点击"连接"按钮后，应用会尝试连接到指定的远程服务器
- **服务器模式**：点击"连接"按钮后，应用会在指定端口启动服务器，等待客户端连接

### 状态判断

- **客户端模式**：当成功连接到远程服务器时，状态显示为"CONNECTED"
- **服务器模式**：当服务器启动成功且有客户端连接时，状态显示为"CONNECTED"；如果没有客户端连接，即使服务器启动成功，状态也会显示为"DISCONNECTED"

### 发送消息

- **客户端模式**：消息将发送到连接的远程服务器
- **服务器模式**：消息将发送到所有已连接的客户端

### 接收消息

- **客户端模式**：接收远程服务器发送的消息
- **服务器模式**：接收任何已连接客户端发送的消息

## 故障排除

### 客户端模式常见问题

1. **连接失败**
   - 检查远程服务器是否正在运行
   - 确认主机地址和端口号正确
   - 排查网络连接是否通畅（可使用ping命令检查）
   - 检查防火墙设置是否阻止了连接

2. **连接成功但无法发送/接收消息**
   - 确认消息格式正确
   - 检查远程服务器是否正确处理消息

### 服务器模式常见问题

1. **服务器无法启动**
   - 检查指定的端口是否已被其他应用占用
   - 尝试使用其他端口号
   - 确认有足够的系统权限绑定端口

2. **服务器启动成功但无客户端连接**
   - 检查客户端是否正确配置了服务器地址和端口
   - 确认防火墙不阻止入站连接
   - 如果在不同机器上，确保网络连通性 